

<!DOCTYPE html>
<html>
  <head>
	<title>Secret Chat</title>
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
	<script>

		//This is the data reference at firebase
		var myDataRef = new Firebase('https://blazing-torch-4959.firebaseio.com/');
		var keepGoing = true;
		var k = 0;
		var futureFill = false;
		var blurred = false;
		//var toggleTitle = 0;		
		//This function gets data from input and sends to firebase using set function, set() function can send value or json object, uses child() to get variable (can also use push function to add to a list).

		/////////////////////////// onFocus stuff

		function onFocus() {
			console.log("focused");
			keepGoing = false;
			blurred = false;
		};

		function onBlur() {
			console.log("blurred");
		    blurred = true;
			keepGoing = true;
		};

		if (/*@cc_on!@*/false) { // check for Internet Explorer
		    document.onfocusin = onFocus;
		    document.onfocusout = onBlur;
		} else {
		    window.onfocus = onFocus;
		    window.onblur = onBlur;
		}
		///////////////////////////////////////////////

		function sendMessage(){
			var text = document.getElementById('speaker').value + ": " + document.getElementById("messageInput").value;
			myDataRef.child("message" + document.getElementById('chatname').value).set(text);	
			document.getElementById('messageInput').value = "";		
		}

		function flashTitle(toggleTitle) {
			console.log(toggleTitle)
			if(toggleTitle%2 == 0) {document.title = "New Message!";}
			if(toggleTitle%2 == 1) {document.title = "Secret Chat";}	
			k = k + 1;
    		if(!keepGoing) {keepGoing = true; document.title = "Secret Chat"; return;}
            setTimeout(function() { flashTitle(k); }, 500);
		}
		
		//This callback function is alerted when firebase value changes and then updates message board. It uses the on() function, firebase sends back a snapshot
		myDataRef.on('value', function(snapshot) {
			var dragon = snapshot.val();
			var msg = "message" + document.getElementById('chatname').value;
			document.getElementById("messageBoard").innerHTML = dragon[msg];
			if(futureFill && blurred) {flashTitle(k);}
			futureFill = true;
			//alert(JSON.stringify(dragon));
		});

		
	</script>
	
	<style>		
		#messageInput{
			margin-left: 25px;	width: 180px;
		}
		#messageBoard{
			background-color:#00FF7F;
			width:200px; height:100px;
			margin: 25px; padding:15px;
			border:3px solid #a1a1a1;
			border-radius:25px;
		}		
	</style>
	
  </head>

  <body>
  Chat Name
  <br>
  <textarea id="chatname" cols="20" rows="1">chat</textarea>
  <br>
  Your name
  <br>
  <textarea id="speaker" cols="20" rows="1">Name</textarea>
  <br>
  Press Enter to send. 
  <br><br>
	<input type='text' id='messageInput' placeholder='Message' onkeyup="javascript: if(event.keyCode==13) {sendMessage();}">
	<div id='messageBoard'>message will show here</div>
  </body>
</html>


<!-- 
<button onclick="sendMessage()">submit</button> 
onclick="this.value='';"
onkeypress="sendMessage()"
'https://lap9k56h5qw.firebaseio-demo.com/'

-->

